//-----------------------------------------------------------------------
// <copyright file="ShowImage.ashx.cs" company="Cognizant">
//     Company copyright tag.
// </copyright>
//-----------------------------------------------------------------------
namespace Buddy.Pages.NA
{
    using System;
    using System.Collections.Generic;
    using System.Data;
    using System.Data.SqlClient;
    using System.IO;
    using System.Linq;
    using System.Runtime.InteropServices;
    using System.Web;
    using BuddyBLL.UserProfileService;

    /// <summary>
    /// Initializes a new instance of class ShowImage
    /// </summary>
    public class ShowImage : IHttpHandler
    {
        /// <summary>
        /// Gets a value indicating whether IsReusable
        /// </summary>
        public bool IsReusable
        {
            get
            {
                return false;
            }
        }

        /// <summary>
        /// Method for ProcessRequest
        /// </summary>
        /// <param name="context">context of http</param>
        public void ProcessRequest(HttpContext context)
        {
            try
            {                
                int empno;
                if (context.Request.QueryString["id"] != null || context.Request.QueryString["id"] != string.Empty)
                {
                    empno = Convert.ToInt32(context.Request.QueryString["id"]);
                }
                else
                {
                    throw new ArgumentException("No parameter specified");
                }

                //// old code commented- now preferring netTcpbinding over basic httpbinding
                //// BuddyBLL.UserProfileService.UserProfileClient objUserProfileClient = new BuddyBLL.UserProfileService.UserProfileClient("BasicHttpBinding_IUserProfile");

                BuddyBLL.UserProfileService.UserProfileClient objUserProfileClient;
                try
                {
                    objUserProfileClient = new BuddyBLL.UserProfileService.UserProfileClient("NetTcpBinding_IUserProfile");
                }
                catch
                {
                    objUserProfileClient = new BuddyBLL.UserProfileService.UserProfileClient("BasicHttpBinding_IUserProfile");
                }

                DataSet ds = new DataSet();
                
                //// ds = objUserProfileClient.GetUserPhotograph(298015);
           
                ds = objUserProfileClient.GetUserPhotograph(empno, "702");
                if (ds != null)
                {
                    context.Response.ContentType = "image/" + ds.Tables[0].Rows[0]["Userphoto_Extension"].ToString() + string.Empty;
                    byte[] b = (byte[])ds.Tables[0].Rows[0]["UserPhoto"];
                    byte[] dummy = 
                                   { 
                                     137, 80, 78, 71, 13, 10, 26, 10, 0, 0, 0, 13, 73, 72, 68, 82, 0, 0, 0, 59, 0, 0, 0, 59, 8, 3, 0, 0, 0, 
                                     242, 251, 2, 129, 0, 0, 0, 25, 116, 69, 88, 116, 83, 111, 102, 116, 119, 97, 114, 101, 0, 65, 100, 111,
                                     98, 101, 32, 73, 109, 97, 103, 101, 82, 101, 97, 100, 121, 113, 201, 101, 60, 0, 0, 3, 32, 105, 84, 88,
                                     116, 88, 77, 76, 58, 99, 111, 109, 46, 97, 100, 111, 98, 101, 46, 120, 109, 112, 0, 0, 0, 0, 0, 60, 63,
                                     120, 112, 97, 99, 107, 101, 116, 32, 98, 101, 103, 105, 110, 61, 34, 239, 187, 191, 34, 32, 105, 100, 61,
                                     34, 87, 53, 77, 48, 77, 112, 67, 101, 104, 105, 72, 122, 114, 101, 83, 122, 78, 84, 99, 122, 107, 99, 57,
                                     100, 34, 63, 62, 32, 60, 120, 58, 120, 109, 112, 109, 101, 116, 97, 32, 120, 109, 108, 110, 115, 58, 120,
                                     61, 34, 97, 100, 111, 98, 101, 58, 110, 115, 58, 109, 101, 116, 97, 47, 34, 32, 120, 58, 120, 109, 112, 116,
                                     107, 61, 34, 65, 100, 111, 98, 101, 32, 88, 77, 80, 32, 67, 111, 114, 101, 32, 53, 46, 48, 45, 99, 48, 54,
                                     48, 32, 54, 49, 46, 49, 51, 52, 55, 55, 55, 44, 32, 50, 48, 49, 48, 47, 48, 50, 47, 49, 50, 45, 49, 55, 58,
                                     51, 50, 58, 48, 48, 32, 32, 32, 32, 32, 32, 32, 32, 34, 62, 32, 60, 114, 100, 102, 58, 82, 68, 70, 32, 120,
                                     109, 108, 110, 115, 58, 114, 100, 102, 61, 34, 104, 116, 116, 112, 58, 47, 47, 119, 119, 119, 46, 119, 51,
                                     46, 111, 114, 103, 47, 49, 57, 57, 57, 47, 48, 50, 47, 50, 50, 45, 114, 100, 102, 45, 115, 121, 110, 116, 97,
                                     120, 45, 110, 115, 35, 34, 62, 32, 60, 114, 100, 102, 58, 68, 101, 115, 99, 114, 105, 112, 116, 105, 111, 110,
                                     32, 114, 100, 102, 58, 97, 98, 111, 117, 116, 61, 34, 34, 32, 120, 109, 108, 110, 115, 58, 120, 109, 112, 61,
                                     34, 104, 116, 116, 112, 58, 47, 47, 110, 115, 46, 97, 100, 111, 98, 101, 46, 99, 111, 109, 47, 120, 97, 112,
                                     47, 49, 46, 48, 47, 34, 32, 120, 109, 108, 110, 115, 58, 120, 109, 112, 77, 77, 61, 34, 104, 116, 116, 112, 58, 47, 47, 110, 115, 46, 97, 100, 111, 98, 101, 46, 99, 111, 109, 47, 120, 97, 112, 47, 49, 46, 48, 47, 109, 109, 47, 34, 32, 120, 109, 108, 110, 115, 58, 115, 116, 82, 101, 102, 61, 34, 104, 116, 116, 112, 58, 47, 47, 110, 115, 46, 97, 100, 111, 98, 101, 46, 99, 111, 109, 47, 120, 97, 112, 47, 49, 46, 48, 47, 115, 84, 121, 112, 101, 47, 82, 101, 115, 111, 117, 114, 99, 101, 82, 101, 102, 35, 34, 32, 120, 109, 112, 58, 67, 114, 101, 97, 116, 111, 114, 84, 111, 111, 108, 61, 34, 65, 100, 111, 98, 101, 32, 80, 104, 111, 116, 111, 115, 104, 111, 112, 32, 67, 83, 53, 32, 87, 105, 110, 100, 111, 119, 115, 34, 32, 120, 109, 112, 77, 77, 58, 73, 110, 115, 116, 97, 110, 99, 101, 73, 68, 61, 34, 120, 109, 112, 46, 105, 105, 100, 58, 49, 56, 56, 67, 49, 53, 55, 48, 67, 55, 52, 55, 49, 49, 69, 49, 66, 69, 70, 67, 67, 66, 65, 65, 65, 65, 69, 66, 56, 49, 51, 57, 34, 32, 120, 109, 112, 77, 77, 58, 68, 111, 99, 117, 109, 101, 110, 116, 73, 68, 61, 34, 120, 109, 112, 46, 100, 105, 100, 58, 49, 56, 56, 67, 49, 53, 55, 49, 67, 55, 52, 55, 49, 49, 69, 49, 66, 69, 70, 67, 67, 66, 65, 65, 65, 65, 69, 66, 56, 49, 51, 57, 34, 62, 32, 60, 120, 109, 112, 77, 77, 58, 68, 101, 114, 105, 118, 101, 100, 70, 114, 111, 109, 32, 115, 116, 82, 101, 102, 58, 105, 110, 115, 116, 97, 110, 99, 101, 73, 68, 61, 34, 120, 109, 112, 46, 105, 105, 100, 58, 49, 56, 56, 67, 49, 53, 54, 69, 67, 55, 52, 55, 49, 49, 69, 49, 66, 69, 70, 67, 67, 66, 65, 65, 65, 65, 69, 66, 56, 49, 51, 57, 34, 32, 115, 116, 82, 101, 102, 58, 100, 111, 99, 117, 109, 101, 110, 116, 73, 68, 61, 34, 120, 109, 112, 46, 100, 105, 100, 58, 49, 56, 56, 67, 49, 53, 54, 70, 67, 55, 52, 55, 49, 49, 69, 49, 66, 69, 70, 67, 67, 66, 65, 65, 65, 65, 69, 66, 56, 49, 51, 57, 34, 47, 62, 32, 60, 47, 114, 100, 102, 58, 68, 101, 115, 99, 114, 105, 112, 116, 105, 111, 110, 62, 32, 60, 47, 114, 100, 102, 58, 82, 68, 70, 62, 32, 60, 47, 120, 58, 120, 109, 112, 109, 101, 116, 97, 62, 32, 60, 63, 120, 112, 97, 99, 107, 101, 116, 32, 101, 110, 100, 61, 34, 114, 34, 63, 62, 158, 122, 253, 237, 0, 0, 2, 247, 80, 76, 84, 69, 238, 236, 236, 205, 203, 203, 228, 226, 226, 222, 220, 220, 233, 231, 231, 232, 231, 231, 208, 206, 206, 229, 227, 227, 209, 207, 207, 224, 222, 222, 194, 193, 193, 193, 191, 191, 132, 132, 132, 193, 192, 192, 190, 189, 189, 131, 131, 131, 245, 243, 243, 129, 129, 129, 192, 190, 190, 192, 191, 191, 196, 195, 195, 234, 232, 232, 134, 134, 134, 196, 194, 194, 135, 135, 135, 199, 198, 198, 115, 115, 115, 206, 205, 205, 237, 235, 235, 127, 127, 127, 118, 118, 118, 125, 125, 125, 122, 122, 122, 191, 190, 190, 205, 204, 204, 120, 120, 120, 195, 194, 194, 235, 233, 233, 194, 192, 192, 206, 204, 204, 216, 214, 214, 198, 197, 197, 200, 198, 198, 227, 225, 225, 197, 195, 195, 190, 188, 188, 102, 102, 102, 185, 184, 184, 204, 202, 202, 198, 196, 196, 189, 188, 188, 213, 212, 212, 108, 107, 107, 97, 97, 97, 209, 208, 208, 207, 206, 206, 195, 193, 193, 203, 202, 202, 100, 99, 99, 208, 207, 207, 214, 212, 212, 213, 211, 211, 210, 209, 209, 228, 227, 227, 230, 228, 228, 211, 209, 209, 202, 200, 200, 204, 203, 203, 105, 105, 105, 227, 226, 226, 197, 196, 196, 137, 137, 137, 78, 78, 78, 219, 218, 218, 221, 219, 219, 207, 205, 205, 212, 210, 210, 220, 218, 218, 86, 86, 86, 217, 215, 215, 113, 113, 113, 232, 230, 230, 219, 217, 217, 94, 94, 94, 110, 110, 110, 91, 91, 91, 62, 62, 62, 225, 223, 223, 199, 197, 197, 233, 232, 232, 214, 213, 213, 235, 234, 234, 215, 213, 213, 220, 219, 219, 244, 242, 242, 236, 235, 235, 203, 201, 201, 64, 64, 64, 186, 185, 185, 188, 186, 186, 217, 216, 216, 223, 221, 221, 231, 229, 229, 59, 58, 58, 57, 56, 56, 89, 88, 88, 191, 189, 189, 60, 60, 60, 216, 215, 215, 212, 211, 211, 210, 208, 208, 218, 216, 216, 200, 199, 199, 81, 80, 80, 211, 210, 210, 187, 185, 185, 234, 233, 233, 215, 214, 214, 180, 179, 179, 83, 83, 83, 237, 236, 236, 241, 240, 240, 55, 55, 55, 244, 243, 243, 184, 183, 183, 201, 199, 199, 185, 183, 183, 184, 182, 182, 202, 201, 201, 226, 225, 225, 218, 217, 217, 128, 128, 128, 186, 184, 184, 242, 241, 241, 66, 66, 66, 240, 239, 239, 182, 181, 181, 238, 237, 237, 229, 228, 228, 243, 241, 241, 241, 239, 239, 222, 221, 221, 225, 224, 224, 168, 167, 167, 124, 124, 124, 230, 229, 229, 98, 98, 98, 226, 224, 224, 188, 187, 187, 177, 176, 176, 150, 150, 150, 231, 230, 230, 201, 200, 200, 140, 140, 140, 179, 178, 178, 243, 242, 242, 189, 187, 187, 169, 168, 168, 224, 223, 223, 114, 113, 113, 164, 163, 163, 183, 181, 181, 144, 143, 143, 181, 180, 180, 181, 179, 179, 151, 151, 151, 223, 222, 222, 138, 138, 138, 221, 220, 220, 178, 177, 177, 183, 183, 183, 239, 238, 238, 127, 126, 126, 89, 89, 89, 139, 138, 138, 190, 190, 190, 151, 150, 150, 150, 149, 149, 182, 182, 182, 144, 144, 144, 168, 166, 166, 187, 186, 186, 142, 142, 142, 135, 133, 133, 122, 121, 121, 183, 182, 182, 92, 92, 92, 108, 108, 108, 91, 90, 90, 149, 148, 148, 131, 130, 130, 84, 83, 83, 141, 141, 141, 85, 85, 85, 136, 136, 136, 152, 150, 150, 175, 175, 175, 154, 154, 154, 158, 158, 158, 162, 162, 162, 174, 173, 173, 78, 77, 77, 167, 166, 166, 96, 95, 95, 83, 82, 82, 165, 165, 165, 143, 142, 142, 166, 165, 165, 156, 156, 156, 184, 184, 184, 93, 92, 92, 175, 174, 174, 99, 99, 99, 175, 173, 173, 148, 148, 148, 154, 153, 153, 166, 166, 166, 204, 204, 204, 126, 126, 126, 149, 149, 149, 156, 155, 155, 80, 80, 80, 120, 119, 119, 167, 165, 165, 133, 133, 133, 136, 135, 135, 63, 63, 63, 118, 117, 117, 173, 172, 172, 160, 159, 159, 155, 153, 153, 201, 201, 201, 133, 132, 132, 121, 120, 120, 114, 114, 114, 85, 84, 84, 242, 240, 240, 170, 169, 169, 186, 186, 186, 142, 141, 141, 164, 164, 164, 166, 164, 164, 146, 146, 146, 179, 179, 179, 125, 123, 123, 197, 197, 197, 155, 155, 155, 171, 170, 170, 90, 90, 90, 61, 60, 60, 239, 237, 237, 236, 234, 234, 240, 238, 238, 202, 251, 152, 252, 0, 0, 5, 69, 73, 68, 65, 84, 120, 218, 204, 214, 101, 112, 219, 86, 0, 192, 113, 25, 147, 72, 145, 230, 26, 230, 186, 242, 182, 218, 53, 67, 13, 233, 12, 51, 198, 158, 211, 218, 137, 155, 217, 219, 234, 112, 178, 208, 182, 44, 180, 208, 154, 53, 220, 100, 129, 50, 51, 51, 115, 199, 204, 204, 204, 204, 204, 210, 62, 76, 182, 147, 15, 219, 156, 202, 245, 237, 118, 251, 157, 191, 232, 221, 253, 173, 103, 249, 189, 119, 2, 248, 205, 86, 61, 37, 21, 250, 79, 1, 68, 69, 97, 166, 167, 34, 183, 15, 40, 104, 28, 168, 201, 72, 69, 176, 4, 240, 86, 171, 25, 244, 84, 212, 214, 0, 185, 52, 6, 128, 165, 66, 170, 6, 152, 68, 251, 71, 42, 112, 234, 191, 223, 98, 120, 26, 173, 90, 209, 94, 100, 207, 82, 100, 20, 98, 231, 215, 226, 212, 38, 71, 86, 145, 195, 105, 203, 69, 27, 34, 248, 121, 181, 133, 165, 13, 237, 17, 87, 255, 146, 106, 123, 11, 69, 32, 207, 87, 135, 132, 73, 183, 244, 162, 198, 189, 109, 251, 57, 223, 237, 89, 123, 226, 205, 87, 126, 121, 250, 164, 32, 175, 166, 60, 201, 150, 103, 183, 45, 245, 33, 123, 54, 204, 142, 219, 119, 246, 145, 111, 196, 77, 210, 164, 90, 188, 90, 28, 208, 175, 157, 250, 23, 207, 177, 3, 64, 18, 45, 22, 161, 100, 31, 124, 224, 194, 191, 217, 160, 11, 37, 209, 74, 237, 221, 35, 153, 255, 52, 181, 0, 35, 109, 49, 170, 124, 112, 246, 5, 9, 156, 85, 147, 182, 64, 64, 121, 247, 148, 113, 153, 223, 254, 112, 234, 232, 196, 197, 148, 14, 210, 22, 87, 108, 92, 120, 81, 220, 125, 219, 223, 61, 189, 209, 51, 50, 113, 121, 42, 137, 246, 248, 37, 113, 239, 47, 59, 189, 101, 77, 55, 99, 193, 129, 241, 235, 133, 228, 115, 30, 120, 111, 122, 204, 242, 183, 182, 60, 214, 138, 166, 109, 98, 13, 44, 140, 15, 76, 39, 111, 131, 203, 103, 196, 220, 243, 114, 151, 42, 44, 93, 192, 98, 209, 247, 197, 7, 102, 144, 182, 244, 210, 139, 227, 118, 230, 228, 185, 22, 179, 8, 192, 134, 241, 17, 128, 164, 197, 168, 75, 167, 197, 61, 209, 143, 47, 98, 177, 22, 148, 149, 249, 151, 143, 143, 240, 72, 90, 124, 43, 253, 231, 231, 127, 253, 250, 128, 238, 24, 45, 90, 110, 90, 52, 52, 244, 227, 21, 113, 239, 184, 177, 115, 183, 82, 90, 237, 166, 177, 82, 215, 112, 25, 49, 217, 178, 161, 206, 197, 139, 135, 77, 211, 174, 138, 203, 164, 146, 180, 194, 64, 144, 183, 206, 13, 176, 88, 139, 58, 135, 15, 141, 142, 98, 88, 243, 231, 179, 198, 61, 235, 38, 251, 189, 190, 34, 191, 111, 157, 176, 115, 120, 126, 249, 124, 66, 241, 67, 119, 94, 62, 238, 112, 158, 148, 116, 109, 168, 75, 20, 253, 248, 104, 121, 155, 180, 184, 184, 216, 245, 240, 204, 9, 95, 104, 66, 24, 249, 30, 164, 102, 133, 219, 70, 203, 121, 133, 60, 158, 123, 231, 101, 19, 182, 213, 209, 147, 216, 131, 194, 154, 188, 246, 177, 114, 188, 144, 193, 96, 188, 118, 233, 132, 76, 200, 225, 35, 221, 131, 152, 212, 229, 183, 103, 149, 166, 21, 22, 134, 214, 161, 47, 93, 25, 183, 242, 227, 102, 226, 196, 163, 10, 207, 221, 226, 105, 190, 180, 72, 189, 217, 156, 239, 99, 132, 86, 172, 189, 58, 110, 229, 201, 138, 158, 65, 165, 211, 239, 227, 97, 231, 104, 67, 53, 75, 182, 210, 154, 26, 5, 124, 175, 127, 108, 5, 117, 214, 245, 49, 47, 236, 112, 182, 174, 217, 181, 153, 43, 86, 4, 212, 194, 73, 219, 90, 191, 159, 86, 111, 147, 247, 201, 140, 26, 187, 111, 108, 253, 29, 115, 99, 78, 68, 60, 29, 29, 186, 74, 157, 86, 101, 110, 160, 225, 147, 180, 188, 106, 69, 105, 187, 88, 160, 82, 65, 58, 145, 211, 69, 215, 205, 189, 41, 234, 200, 235, 75, 52, 27, 123, 16, 173, 238, 246, 51, 18, 143, 185, 70, 152, 176, 5, 130, 206, 250, 34, 111, 14, 200, 205, 129, 186, 122, 42, 92, 135, 42, 159, 186, 49, 234, 201, 226, 124, 100, 183, 17, 132, 170, 122, 123, 207, 64, 18, 148, 154, 176, 117, 219, 108, 13, 98, 46, 204, 129, 249, 96, 229, 110, 142, 191, 243, 216, 156, 152, 223, 218, 228, 93, 58, 136, 11, 34, 85, 131, 186, 214, 213, 150, 122, 32, 65, 43, 164, 89, 245, 98, 129, 140, 45, 98, 91, 36, 200, 72, 175, 184, 48, 252, 224, 209, 207, 110, 125, 230, 248, 246, 189, 224, 14, 132, 171, 177, 176, 17, 99, 85, 107, 171, 145, 25, 74, 208, 74, 243, 5, 74, 1, 31, 18, 33, 34, 144, 43, 171, 236, 128, 74, 135, 190, 218, 47, 111, 92, 193, 42, 111, 172, 234, 1, 13, 6, 62, 84, 135, 24, 55, 175, 54, 234, 169, 9, 90, 158, 130, 207, 145, 65, 108, 17, 194, 1, 185, 92, 100, 87, 23, 218, 86, 230, 202, 171, 22, 150, 45, 85, 14, 26, 53, 74, 37, 23, 102, 215, 105, 181, 70, 164, 66, 157, 184, 53, 34, 136, 136, 205, 129, 96, 11, 31, 174, 28, 1, 131, 188, 101, 63, 29, 126, 53, 220, 34, 170, 2, 13, 57, 26, 9, 241, 189, 68, 44, 178, 174, 74, 212, 230, 115, 17, 68, 203, 134, 96, 152, 3, 129, 18, 145, 174, 202, 240, 225, 45, 132, 187, 62, 210, 114, 12, 6, 46, 95, 34, 131, 137, 73, 213, 137, 172, 137, 238, 139, 135, 11, 216, 16, 155, 3, 131, 48, 4, 193, 18, 139, 182, 242, 141, 107, 98, 142, 172, 230, 10, 148, 26, 62, 159, 24, 231, 64, 108, 54, 234, 78, 208, 2, 84, 61, 209, 17, 177, 76, 38, 131, 65, 9, 220, 113, 255, 188, 152, 15, 30, 85, 22, 40, 115, 52, 124, 144, 72, 97, 14, 232, 192, 19, 253, 191, 194, 38, 3, 49, 95, 54, 4, 90, 44, 160, 12, 4, 215, 188, 125, 67, 204, 188, 79, 10, 162, 45, 23, 228, 136, 32, 8, 212, 175, 74, 188, 38, 233, 121, 252, 58, 81, 244, 41, 75, 36, 22, 16, 236, 189, 247, 218, 152, 223, 191, 23, 8, 4, 209, 27, 195, 108, 132, 227, 9, 23, 39, 110, 49, 106, 186, 76, 11, 11, 186, 5, 196, 93, 248, 18, 240, 182, 235, 98, 190, 228, 171, 84, 196, 26, 111, 86, 17, 143, 210, 83, 79, 159, 108, 31, 1, 212, 60, 131, 165, 155, 226, 173, 240, 52, 171, 10, 12, 218, 153, 55, 19, 230, 188, 104, 181, 90, 43, 172, 20, 74, 159, 68, 102, 13, 16, 59, 24, 155, 108, 239, 243, 130, 232, 250, 10, 74, 174, 217, 140, 138, 245, 125, 7, 183, 61, 62, 103, 229, 50, 155, 201, 100, 74, 103, 230, 82, 60, 30, 103, 116, 251, 98, 147, 159, 57, 128, 218, 142, 234, 197, 54, 103, 75, 182, 201, 102, 102, 58, 91, 28, 89, 132, 150, 116, 148, 66, 49, 5, 233, 100, 103, 157, 176, 150, 230, 48, 163, 102, 83, 54, 193, 81, 84, 210, 174, 40, 201, 202, 182, 161, 185, 38, 197, 42, 30, 217, 25, 139, 97, 0, 47, 141, 86, 98, 146, 123, 189, 122, 175, 151, 34, 22, 203, 137, 15, 179, 33, 63, 163, 86, 154, 196, 187, 10, 32, 228, 185, 51, 154, 28, 233, 76, 20, 149, 203, 229, 104, 46, 51, 61, 187, 36, 208, 95, 43, 21, 98, 255, 193, 59, 240, 255, 188, 165, 132, 221, 82, 60, 21, 140, 8, 176, 222, 78, 83, 167, 165, 34, 50, 240, 167, 0, 3, 0, 75, 163, 112, 158, 195, 246, 60, 56, 0, 0, 0, 0, 73, 69, 78, 68, 174, 66, 96, 130 
                                   };
                    bool isValid = false;

                    for (int i = 0; i < 100; i++)
                    {
                        if (b[i] != dummy[i])
                        {
                            isValid = true;
                            context.Response.BinaryWrite(b);
                            context.Response.End();
                        }                        
                    }

                    if (!isValid)
                    {
                        context.Response.Status = "500 error";
                    }
                }
            }
            catch
            {
                if (context.Response.Status != "200 OK")
                {
                    context.Response.Status = "500 error";
                }
                else
                {
                    context.Response.Status = "200 OK";
                }
            }
            
            //// Stream strm = new MemoryStream((byte[])ds.Tables[0].Rows[0]["UserPhoto"]);
            //// byte[] buffer = new byte[4096];
            //// int byteSeq = strm.Read(buffer, 0, 4096);

            //// while (byteSeq > 0)
            //// {
            //// context.Response.OutputStream.Write(buffer, 0, byteSeq);
            //// byteSeq = strm.Read(buffer, 0, 4096);
            //// }            
        }
    }
}
